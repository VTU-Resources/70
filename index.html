<!doctype html>
<html lang="en" class="antialiased">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BUILDORA.ai</title>

  <!-- Google font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN (kept for convenience) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Poppins', 'Inter', 'system-ui', 'sans-serif'] },
          colors: {
            buildora: {
              50: '#fff7ed',
              500: '#f97316',
              600: '#ea580c'
            }
          },
          boxShadow: {
            'soft-lg': '0 15px 30px rgba(10,10,10,0.08)',
            'card': '0 10px 22px rgba(16,24,40,0.06)'
          }
        }
      },
      darkMode: 'class'
    };
  </script>

  <style>
    /* (kept your styles exactly as provided, minimal edits for modal layout) */
    :root{
      --safe-max-width: 1100px;
      --accent: #f97316;
      --muted: #6b7280;
      --radius: 14px;
    }
    html { font-size: 14px; }
    body { font-family: Poppins, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; color: #111827; background: #ffffff; }
    :root { --base-size: clamp(13px, 1.8vw, 15px); }
    body, input, button, textarea, select { font-size: var(--base-size); line-height: 1.35; }
    #app { max-width: var(--safe-max-width); margin: 0 auto; padding: calc(1rem + env(safe-area-inset-top)) 1rem calc(1rem + env(safe-area-inset-bottom)); min-height: 100vh; }
    h1 { font-size: clamp(18px, 3.4vw, 28px); margin: 0; }
    h2 { font-size: clamp(16px, 2.8vw, 22px); margin: 0; }
    h3 { font-size: clamp(15px, 2.4vw, 18px); margin: 0; }
    :focus { outline: none; box-shadow: 0 0 0 4px rgba(249,115,22,.09); border-radius: .375rem; }
    .lds-dot { display:inline-block; width:9px; height:9px; border-radius:50%; border-bottom:2px solid #fff; animation: spinDot .9s linear infinite; }
    @keyframes spinDot { to { transform: rotate(360deg) } }
    .modal-backdrop { animation: fadeIn .16s ease both; }
    .modal-card { animation: popIn .18s cubic-bezier(.2,.9,.3,1) both; }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
    @keyframes popIn { from { transform: translateY(6px) scale(.98); opacity: 0 } to { transform: translateY(0) scale(1); opacity: 1 } }
    .no-scroll { overflow: hidden; height: 100vh; }
    .error-box { background: #fff1f2; color:#b91c1c; }
    @media (min-width: 640px) { .logo { height:4rem; } }
    main { padding-bottom: 5.5rem; }
    .safe-radius { border-radius: .8rem; overflow: visible; }
    .form-input { transition: box-shadow .12s ease, transform .12s ease; border-radius: 10px; }
    .form-input:focus { transform: translateY(-1px); }
    .modal-card { max-height: calc(100vh - 120px); overflow-y: auto; -webkit-overflow-scrolling: touch; width: calc(100% - 32px); max-width: 520px; border-radius: 18px; }
    .badge-prem { background: linear-gradient(90deg,#facc15,#fb923c); color:white; padding: .18rem .55rem; border-radius: 999px; font-weight:600; font-size: .82rem; display:inline-flex; gap:.3rem; align-items:center; }
    .feature-card { border-radius: 14px; padding: 0.9rem; }
    .feature-icon-wrap { width:56px; height:56px; border-radius: 12px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
    .pm-title { font-size: clamp(16px, 2.6vw, 20px); font-weight: 700; }
    .pm-sub { font-size: clamp(12px, 1.7vw, 14px); color: var(--muted); }
    .text-ellipsis-wrap { white-space: normal; word-break: break-word; }
    .accent-btn:focus { box-shadow: 0 8px 30px rgba(249,115,22,0.12); transform: translateY(-1px); }
    .card-shadow { box-shadow: var(--tw-shadow, 0 10px 20px rgba(2,6,23,0.06)); }
    .hero-cta { gap: .5rem; flex-wrap: wrap; justify-content: center; }
    .header-wrap { padding: .6rem; border-radius: 12px; }
    .logout-btn { padding: .45rem .6rem; border-radius: 10px; }
    .success-circle { width:64px; height:64px; border-radius:999px; display:flex; align-items:center; justify-content:center; }
    .tick-img { width:20px; height:20px; display:inline-block; object-fit:contain; margin-right:.6rem; }
    @media (max-width: 360px) { .modal-card { padding: 1rem; } .feature-icon-wrap { width:48px; height:48px; } }
    #themeToggle { position: fixed !important; left: calc(12px + env(safe-area-inset-left)); top: calc(12px + env(safe-area-inset-top)); right: auto !important; z-index: 80; width: 48px; height: 48px; padding: 6px; border-radius: 12px; display: inline-flex; align-items: center; justify-content: center; transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); box-shadow: 0 12px 30px rgba(16,24,40,0.08); border: 1px solid rgba(2,6,23,0.06); background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(250,250,250,0.88)); color: var(--accent); }
    #themeToggle:active { transform: translateY(1px) scale(.985); }
    .dark #themeToggle { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); color: #fbbf24; border-color: rgba(255,255,255,0.06); }
    #themeIcon svg { width:20px; height:20px; }
    #paymentModal { align-items: flex-start; padding-top: calc(14vh + env(safe-area-inset-top)); }
    .pm-logo { width: 80px; height: 80px; border-radius: 999px; display:flex; align-items:center; justify-content:center; overflow:hidden; margin: 0 auto 0.8rem auto; background: linear-gradient(135deg,#ff9800,#fb923c); box-shadow: 0 8px 30px rgba(249,115,22,0.12); border: 6px solid rgba(255,255,255,0.85); }
    .pm-logo img { width: 64px; height: 64px; object-fit: cover; border-radius: 999px; display:block; }
    .modal-card { margin: 0 12px; }
    .pm-sub { opacity: .9; }
  </style>
</head>
<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">

  <div id="app" class="min-h-screen flex flex-col">

    <!-- THEME TOGGLE -->
    <button id="themeToggle" aria-label="Toggle theme" title="Toggle light / dark" aria-pressed="false">
      <span id="themeIcon" class="inline-block" aria-hidden="true"></span>
    </button>

    <!-- ROOT CONTENT -->
    <div id="root-content" class="w-full flex-1 flex flex-col">

      <!-- INITIAL LOADER -->
      <div id="initialLoader" class="min-h-screen flex items-center justify-center">
        <div class="flex flex-col items-center space-y-3">
          <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full">
            <svg xmlns="logo.png" class="w-10 h-10 text-white" viewBox="0 0 24 24" fill="none">
              <path d="M12 3l.94 2.365L15.5 6.5l-2.56 1.135L12 9.5l-.939-1.865L8.5 6.5l2.56-.135L12 3zM6 14l1.06 2.365L8.5 18.5l-2.56 1.135L6 21.5 5.061 19.635 2.5 18.5l2.56-1.135L6 14z" fill="currentColor"/>
            </svg>
          </div>
          <div class="text-center">
            <div class="text-sm font-semibold">BUILDORA.ai</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">Initializingâ€¦</div>
          </div>
        </div>
      </div>

     <!-- AUTH VIEW -->
<main id="authView" class="hidden min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-5 border border-gray-100 dark:border-gray-700">
      <div class="text-center mb-4">
        <div class="inline-flex items-center justify-center mb-2 gap-3">
          <div class="w-11 h-11 rounded-full overflow-hidden bg-white">
            <img src="logo.png" alt="BUILDORA logo" class="w-full h-full object-cover" />
          </div>
          <div class="text-left">
            <div class="text-base font-semibold select-none">BUILDORA</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">Create your own brand APP / Website</div>
          </div>
        </div>
      </div>

            <form id="authForm" class="space-y-3" novalidate>
              <div>
                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Username</label>
                <div class="relative">
                  <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none">
                    <path d="M12 12a4 4 0 100-8 4 4 0 000 8zM4 20a8 8 0 0116 0" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <input id="usernameInput" name="username" type="text" inputmode="text" autocomplete="username"
                    class="w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-buildora-500 focus:border-transparent transition-colors form-input"
                    placeholder="Enter a username (min 3 chars)" />
                </div>
              </div>

              <div>
                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                <div class="relative">
                  <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none">
                    <path d="M16 11V7a4 4 0 10-8 0v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                    <rect x="3" y="11" width="18" height="10" rx="2" stroke="currentColor" stroke-width="1.4"/>
                  </svg>

                  <input id="passwordInput" name="password" type="password" autocomplete="current-password"
                    class="w-full pl-10 pr-10 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-buildora-500 focus:border-transparent transition-colors form-input"
                    placeholder="Enter password (min 6 chars)" />
                  <button id="toggleShowPassword" type="button" aria-label="Toggle password visibility" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg id="eyeIcon" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="12" r="3" stroke-width="1.4"/>
                    </svg>
                  </button>
                </div>
              </div>

              <div id="authError" class="hidden text-sm text-center p-2 rounded-md error-box"></div>

              <button id="authSubmit"
                class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-2.5 px-4 rounded-lg font-medium hover:from-orange-600 hover:to-orange-700 focus:ring-2 focus:ring-orange-500 focus:ring-offset-1 disabled:opacity-50 disabled:cursor-not-allowed transition-all safe-radius accent-btn"
                type="submit">
                <span id="authSubmitLabel">Sign In</span>
              </button>
            </form>

            <div class="mt-3 text-center">
              <button id="switchMode" class="text-orange-500 hover:text-orange-600 font-medium text-xs">Don't have an account? Sign up</button>
            </div>
          </div>
        </div>
      </main>

      <!-- DASHBOARD VIEW -->
      <main id="dashboardView" class="hidden min-h-screen p-3 flex flex-col items-center">
        <div class="w-full max-w-6xl">

          <!-- header / user -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl card-shadow p-3 mb-5 border border-gray-100 dark:border-gray-700 header-wrap">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <img src="logo.png" alt="avatar" class="w-11 h-11 rounded-full" />
                <div>
                  <div id="welcomeName" class="text-sm font-semibold text-gray-900 dark:text-white">Welcome, User!</div>
                  <div id="acctStatus" class="mt-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                    Free Account
                  </div>
                </div>
              </div>

              <div class="flex items-center gap-2">
                <button id="logoutBtn" class="logout-btn text-gray-600 dark:text-gray-300 hover:text-red-500 transition-colors inline-flex items-center gap-2 px-3 py-2 rounded-md">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none"><path d="M16 17l5-5-5-5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 12H9" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M13 19H6a2 2 0 01-2-2V7a2 2 0 012-2h7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  <span class="hidden sm:inline text-xs">Logout</span>
                </button>
              </div>
            </div>
          </div>

          <!-- hero - free / premium -->
          <div id="heroSection" class="text-center mb-6">
            <div id="heroFree" class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-2xl p-4 text-white mb-4">
              <h2 class="text-lg md:text-2xl font-bold mb-1">Unlock Your Creative Potential</h2>
              <p class="text-xs md:text-sm opacity-90 mb-3">Start building your dream app or website for just â‚¹9</p>
              <div class="flex items-center hero-cta gap-2 justify-center">
                <button id="getPremiumBtn" class="bg-white text-orange-600 px-4 py-1.5 rounded-lg font-semibold hover:bg-gray-100 transition inline-flex items-center gap-2 text-sm">
                  <span>Get Premium Access</span>
                  <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M13 5l7 7-7 7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </button>
              </div>
            </div>

            <div id="heroPremium" class="hidden bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-4 text-white mb-4">
              <h2 class="text-lg md:text-2xl font-bold mb-1">ðŸ‘‘ Premium Access Unlocked!</h2>
              <p class="text-xs md:text-sm opacity-90 mb-3">You now have full access to all features</p>
              <div class="flex items-center justify-center gap-2 hero-cta">
                <button id="startBuildingBtn" class="bg-white text-green-600 px-4 py-1.5 rounded-lg font-semibold hover:bg-gray-100 transition inline-flex items-center gap-2 text-sm">
                  <span>Start Building</span>
                  <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M13 5l7 7-7 7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </button>
              </div>
            </div>
          </div>

          <!-- features -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div id="featuresGrid" class="col-span-1 grid gap-3"></div>
          </div>

          <!-- stats -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 border border-gray-100 dark:border-gray-700">
            <h3 class="text-sm font-semibold text-center mb-3">Why Choose BUILDORA?</h3>
            <div class="grid grid-cols-3 gap-4 text-center">
              <div>
                <div class="text-lg font-bold text-orange-500 mb-1">10,000+</div>
                <div class="text-xs text-gray-600 dark:text-gray-400">Apps Created</div>
              </div>
              <div>
                <div class="text-lg font-bold text-orange-500 mb-1">99.9%</div>
                <div class="text-xs text-gray-600 dark:text-gray-400">Uptime</div>
              </div>
              <div>
                <div class="text-lg font-bold text-orange-500 mb-1">24/7</div>
                <div class="text-xs text-gray-600 dark:text-gray-400">Support</div>
              </div>
            </div>
          </div>

        </div>
      </main>
    </div>
  </div>

  <!-- PAYMENT MODAL -->
  <div id="paymentModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 modal-backdrop bg-black/30" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-card bg-white dark:bg-gray-800 rounded-2xl p-5 border border-gray-100 dark:border-gray-700" role="document" aria-labelledby="paymentTitle">
      <div id="pmContent"></div>
    </div>
  </div>

  <!-- RAZORPAY SCRIPT -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- SINGLE SCRIPT: STORAGE + APP LOGIC -->
  <script>
    /****************************************
     * STORAGE KEYS + HELPERS
     ****************************************/
    const STORAGE_KEYS = {
      USERS: 'buildora_users_v2',
      USER: 'buildora_user_v2',
      THEME: 'buildora_theme_v2'
    };

    function getUsers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.USERS);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error('getUsers parse error', e);
        return [];
      }
    }

    function saveUsers(users) {
      localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users || []));
    }

    function addUser(user) {
      const users = getUsers();
      users.push(user);
      saveUsers(users);
    }

    function findUserByUsername(username) {
      return getUsers().find(u => u.username === username);
    }

    function saveUser(user) {
      localStorage.setItem(STORAGE_KEYS.USER, JSON.stringify(user));
    }

    function getUser() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.USER);
        return raw ? JSON.parse(raw) : null;
      } catch (e) {
        return null;
      }
    }

    function updateUser(updated) {
      const users = getUsers().map(u => (u.id === updated.id ? updated : u));
      saveUsers(users);
      saveUser(updated);
    }

    function setTheme(theme) {
      localStorage.setItem(STORAGE_KEYS.THEME, theme);
    }

    function getTheme() {
      return localStorage.getItem(STORAGE_KEYS.THEME) || null;
    }

    /****************************************
     * APP LOGIC (IIFE)
     ****************************************/
    (function () {
      // Elements
      const initialLoader = document.getElementById('initialLoader');
      const authView = document.getElementById('authView');
      const dashboardView = document.getElementById('dashboardView');

      const authForm = document.getElementById('authForm');
      const authSubmit = document.getElementById('authSubmit');
      const authSubmitLabel = document.getElementById('authSubmitLabel');
      const usernameInput = document.getElementById('usernameInput');
      const passwordInput = document.getElementById('passwordInput');
      const authError = document.getElementById('authError');
      const switchMode = document.getElementById('switchMode');
      const toggleShowPassword = document.getElementById('toggleShowPassword');
      const eyeIcon = document.getElementById('eyeIcon');

      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');

      const welcomeName = document.getElementById('welcomeName');
      const acctStatus = document.getElementById('acctStatus');
      const logoutBtn = document.getElementById('logoutBtn');

      const heroFree = document.getElementById('heroFree');
      const heroPremium = document.getElementById('heroPremium');
      const getPremiumBtn = document.getElementById('getPremiumBtn');
      const startBuildingBtn = document.getElementById('startBuildingBtn');

      const featuresGrid = document.getElementById('featuresGrid');
      const paymentModal = document.getElementById('paymentModal');
      const pmContent = document.getElementById('pmContent');

      // state
      let isLoginMode = true;
      let currentUser = null;

      // features
      const features = [
        {
          key: 'mobile',
          img: 'app.png',
          title: "Mobile App Builder",
          description: "Create stunning mobile applications with drag-and-drop interface",
          premium: true
        },
        {
          key: 'web',
          img: 'web.png',
          title: "Website Builder",
          description: "Build responsive websites with modern templates and components",
          premium: true
        },
        {
          key: 'branding',
          img: 'custombranding.png',
          title: "Custom Branding",
          description: "Add your own logo, colors, and branding to make it uniquely yours",
          premium: true
        },
        {
          key: 'templates',
          img: 'Premium Templates.png',
          title: "Premium Templates",
          description: "Access to 100+ professional templates and design components",
          premium: true
        }
      ];

      /********************************
       * THEME: apply + toggle + icon
       ********************************/
      function applyTheme(theme) {
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
          setThemeIcon('sun');
          themeToggle.setAttribute('aria-pressed','true');
        } else {
          document.documentElement.classList.remove('dark');
          setThemeIcon('moon');
          themeToggle.setAttribute('aria-pressed','false');
        }
      }

      function setThemeIcon(kind) {
        if (kind === 'sun') {
          themeIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4M12 7a5 5 0 100 10 5 5 0 000-10z" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        } else {
          themeIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        }
      }

      themeToggle.addEventListener('click', () => {
        const current = getTheme() || (document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        const next = current === 'dark' ? 'light' : 'dark';
        setTheme(next);
        applyTheme(next);
      });

      (function initTheme() {
        const saved = getTheme();
        if (saved) {
          applyTheme(saved);
        } else {
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          applyTheme(prefersDark ? 'dark' : 'light');
        }
      })();

      /********************************
       * AUTH UI
       ********************************/
      function showError(msg) {
        authError.textContent = msg;
        authError.classList.remove('hidden');
        authError.classList.add('block');
      }
      function clearError() {
        authError.classList.add('hidden');
        authError.classList.remove('block');
        authError.textContent = '';
      }

      // switch login/signup mode
      switchMode.addEventListener('click', () => {
        isLoginMode = !isLoginMode;
        updateAuthMode();
      });

      function updateAuthMode() {
        if (isLoginMode) {
          authSubmitLabel.textContent = 'Sign In';
          switchMode.textContent = "Don't have an account? Sign up";
          usernameInput.placeholder = 'Enter a username (min 3 chars)';
        } else {
          authSubmitLabel.textContent = 'Create Account';
          switchMode.textContent = 'Already have an account? Sign in';
          usernameInput.placeholder = 'Choose a username (min 3 chars)';
        }
        clearError();
      }

      // toggle password visibility
      toggleShowPassword.addEventListener('click', () => {
        const t = passwordInput;
        if (t.type === 'password') {
          t.type = 'text';
          eyeIcon.innerHTML = '<path d="M3 3l18 18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M9.88 9.88A3.5 3.5 0 0114.12 14.12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>';
        } else {
          t.type = 'password';
          eyeIcon.innerHTML = '<path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.4"/>';
        }
      });

      authForm.addEventListener('submit', (e) => {
        e.preventDefault();
        clearError();

        const username = usernameInput.value.trim();
        const password = passwordInput.value;

        if (!username || !password) {
          showError('Please fill in all fields.');
          return;
        }
        if (username.length < 3) {
          showError('Username must be at least 3 characters.');
          return;
        }
        if (password.length < 6) {
          showError('Password must be at least 6 characters.');
          return;
        }

        authSubmit.disabled = true;
        const prevLabel = authSubmitLabel.textContent;
        authSubmitLabel.textContent = (isLoginMode ? 'Signing in...' : 'Creating account...');

        setTimeout(() => {
          if (isLoginMode) {
            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
              saveUser(user);
              onLoginSuccess(user);
            } else {
              showError('Invalid username or password');
            }
          } else {
            const users = getUsers();
            const existing = users.find(u => u.username === username);
            if (existing) {
              showError('Username already exists');
            } else {
              const newUser = {
                id: Date.now(),
                username,
                password,
                isPaid: false,
                createdAt: new Date().toISOString()
              };
              addUser(newUser);
              saveUser(newUser);
              onLoginSuccess(newUser);
            }
          }
          authSubmit.disabled = false;
          authSubmitLabel.textContent = prevLabel;
        }, 700);
      });

      /********************************
       * LOGIN SUCCESS -> Dashboard
       ********************************/
      function onLoginSuccess(user) {
        currentUser = user;
        renderAppForUser();
      }

      function renderAppForUser() {
        authView.classList.add('hidden');
        initialLoader.classList.add('hidden');
        dashboardView.classList.remove('hidden');

        welcomeName.textContent = `Welcome, ${currentUser.username}!`;

        // indicate premium with crown emoji and nicer style
        if (currentUser.isPaid) {
          acctStatus.innerHTML = 'ðŸ‘‘ Premium Member';
          acctStatus.classList.remove('bg-gray-100','text-gray-700');
          acctStatus.classList.add('bg-gradient-to-r','from-yellow-400','to-orange-500','text-white');
          heroFree.classList.add('hidden');
          heroPremium.classList.remove('hidden');
        } else {
          acctStatus.textContent = 'Free Account';
          heroFree.classList.remove('hidden');
          heroPremium.classList.add('hidden');
          acctStatus.classList.remove('bg-gradient-to-r','from-yellow-400','to-orange-500','text-white');
          acctStatus.classList.add('bg-gray-100','dark:bg-gray-700','text-gray-700','dark:text-gray-300');
        }

        // features
        featuresGrid.innerHTML = '';
        features.forEach(f => {
          const card = document.createElement('div');
          card.className = 'bg-white dark:bg-gray-800 feature-card border border-gray-100 dark:border-gray-700 transition-all duration-200 flex gap-3 items-start';
          if (!currentUser.isPaid && f.premium) card.classList.add('opacity-80');

          const thumbnail = document.createElement('div');
          thumbnail.className = (currentUser.isPaid ? 'feature-icon-wrap bg-gradient-to-r from-orange-500 to-orange-600 text-white' : 'feature-icon-wrap bg-gray-100 dark:bg-gray-700 text-gray-400');
          thumbnail.innerHTML = `<img src="${f.img}" alt="${f.title}" class="w-full h-full object-cover rounded-md" />`;

          const content = document.createElement('div');
          content.className = 'flex-1';
          const crown = currentUser.isPaid ? ' ðŸ‘‘' : ((f.premium && !currentUser.isPaid) ? ' â˜…' : '');
          content.innerHTML = `
            <div class="flex items-start justify-between gap-2">
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-0 text-ellipsis-wrap">${f.title}${crown}</h3>
            </div>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 mb-1">${f.description}</p>
            ${(!currentUser.isPaid && f.premium ? '<div class="mt-1 text-xs text-orange-500 font-medium">Premium Feature - Upgrade to unlock</div>' : '')}
          `;

          card.appendChild(thumbnail);
          card.appendChild(content);
          featuresGrid.appendChild(card);
        });

        // scroll top
        window.scrollTo({ top: 0, left: 0, behavior: 'smooth' });
      }

      /********************************
       * LOGOUT
       ********************************/
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem(STORAGE_KEYS.USER);
        currentUser = null;
        dashboardView.classList.add('hidden');
        authView.classList.remove('hidden');
        usernameInput.value = '';
        passwordInput.value = '';
        clearError();
      });

      /********************************
       * START BUILDING (simulate)
       ********************************/
      startBuildingBtn && startBuildingBtn.addEventListener('click', () => {
        alert('Starting builder (this would navigate to your app builder).');
      });

      /********************************
       * PAYMENT: modal + razorpay integration
       ********************************/

      // Price config (in paise): â‚¹9 => 900 paise
      const PRICE_RUPEES = 9;
      const PRICE_PAISE = PRICE_RUPEES * 100;

      // Replace this with your live/test key
      const RAZORPAY_KEY = 'REPLACE_WITH_YOUR_RAZORPAY_KEY'; // <-- Add your key here

      function openPaymentModal() {
        pmContent.innerHTML = '';
        paymentModal.classList.remove('hidden');
        paymentModal.setAttribute('aria-hidden', 'false');
        document.body.classList.add('no-scroll');
        renderPaymentStep({ stage: 'main' });
      }

      function closePaymentModal() {
        paymentModal.classList.add('hidden');
        paymentModal.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('no-scroll');
      }

      function renderPaymentStep(state) {
        const TICK_IMG = 'https://img.icons8.com/fluency/48/000000/checked.png'; // green tick
        const CARD_IMG = 'logo.png';
        const SECURE_IMG = 'lock-icon.png';

        if (state.stage === 'main') {
          pmContent.innerHTML = `
            <div class="flex items-center justify-between mb-3">
              <h3 id="paymentTitle" class="pm-title text-gray-900 dark:text-white">Upgrade to Premium</h3>
              <button id="pmClose" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" aria-label="Close">&times;</button>
            </div>
            <div class="text-center mb-3">
              <div class="pm-logo" role="img" aria-label="brand logo">
                <img src="${CARD_IMG}" alt="brand" />
              </div>
              <div class="text-2xl font-bold text-gray-900 dark:text-white mb-0">â‚¹${PRICE_RUPEES}</div>
              <div class="pm-sub mb-2">One-time payment for lifetime access</div>
            </div>
            <div class="space-y-2 mb-3 text-sm text-gray-700 dark:text-gray-300">
              <div class="flex items-center"><img class="tick-img" src="${TICK_IMG}" alt="tick" />Unlimited App & Website Creation</div>
              <div class="flex items-center"><img class="tick-img" src="${TICK_IMG}" alt="tick" />100+ Premium Templates</div>
              <div class="flex items-center"><img class="tick-img" src="${TICK_IMG}" alt="tick" />Custom Branding & Logo</div>
              <div class="flex items-center"><img class="tick-img" src="${TICK_IMG}" alt="tick" />24/7 Priority Support</div>
            </div>
            <div class="text-center mb-3 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center gap-2">
              <img src="${SECURE_IMG}" alt="secure" class="w-4 h-4" />
              Secure payment powered by Razorpay
            </div>
            <div>
              <button id="pmPayBtn" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-2.5 rounded-lg font-medium hover:from-orange-600 hover:to-orange-700 focus:ring-2 focus:ring-orange-500 transition accent-btn">Pay â‚¹${PRICE_RUPEES} & Get Premium Access</button>
            </div>
          `;
          // events
          document.getElementById('pmClose').addEventListener('click', closePaymentModal);
          document.getElementById('pmPayBtn').addEventListener('click', doRazorpayPayment);
        } else if (state.stage === 'processing') {
          pmContent.innerHTML = `
            <div class="text-center p-6">
              <div class="inline-flex items-center justify-center w-20 h-20 bg-orange-100 rounded-full mb-3">
                <div class="lds-dot"></div>
              </div>
              <div class="text-sm font-semibold text-gray-900 dark:text-white mb-1">Processing Paymentâ€¦</div>
              <div class="text-xs text-gray-600 dark:text-gray-400">Please wait while we process your secure payment.</div>
            </div>
          `;
        } else if (state.stage === 'success') {
          pmContent.innerHTML = `
            <div class="text-center p-5">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-green-500 rounded-full mb-3 success-circle">
                <svg class="w-7 h-7 text-white" viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div class="text-2xl mb-1">ðŸ‘‘</div>
              <div class="text-sm font-bold text-gray-900 dark:text-white mb-1">Payment Successful!</div>
              <div class="text-xs text-gray-600 dark:text-gray-400 mb-2">Welcome to BUILDORA Premium</div>
              <div class="text-xs text-orange-500 font-medium animate-pulse">Redirecting to dashboardâ€¦</div>
            </div>
          `;
        } else if (state.stage === 'failed') {
          const errMsg = (state.error && state.error.description) ? state.error.description : 'Payment failed or was cancelled. Please try again.';
          pmContent.innerHTML = `
            <div class="text-center p-4">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-red-500 rounded-full mb-3 success-circle">
                <svg class="w-7 h-7 text-white" viewBox="0 0 24 24"><path d="M6 6l12 12M6 18L18 6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div class="text-sm font-bold text-gray-900 dark:text-white mb-2">Payment Failed</div>
              <div class="text-xs text-gray-600 dark:text-gray-400 mb-3">${errMsg}</div>
              <div class="flex gap-2">
                <button id="pmRetry" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-2.5 rounded-lg font-medium">Try Again</button>
                <button id="pmCancel" class="w-full border border-gray-300 dark:border-gray-600 py-2.5 rounded-lg">Cancel</button>
              </div>
            </div>
          `;
          document.getElementById('pmRetry').addEventListener('click', () => renderPaymentStep({ stage: 'main' }));
          document.getElementById('pmCancel').addEventListener('click', closePaymentModal);
        }
      }

      // Core Razorpay flow (client-side)
  function doRazorpayPayment() {
    const RAZORPAY_KEY = 'rzp_test_RU1OCnC9QDHtJj'; // âœ… Your Razorpay Test Key
    const PRICE_RUPEES = 9;                         // âœ… â‚¹9
    const PRICE_PAISE = PRICE_RUPEES * 100;         // âœ… 900 paise

    // Build options
    const options = {
      key: RAZORPAY_KEY, // Enter the Key ID provided by Razorpay
      amount: PRICE_PAISE, // amount in paise
      currency: "INR",
      name: "BUILDORA.ai",
      description: `Premium access â€” â‚¹${PRICE_RUPEES}`,
      image: "logo.png",
      prefill: {
        name: currentUser ? currentUser.username : '',
        email: "" // optional: add an email field if you collect it
      },
      theme: {
        color: "#F97316"
      },
      notes: {
        userId: currentUser ? currentUser.id : 'guest'
      },
      handler: function (response) {
        // Payment succeeded client-side: response has payment id (and order id if used)
        // NOTE: For secure production, you MUST verify this signature server-side using your Razorpay secret.
        // For demo purposes we'll accept the client success and mark the user as paid.
        try {
          currentUser.isPaid = true;
          updateUser(currentUser);
          renderPaymentStep({ stage: 'success' });
          setTimeout(() => {
            closePaymentModal();
            renderAppForUser();
          }, 1100);
        } catch (err) {
          console.error('Error updating user after payment', err);
          renderPaymentStep({ stage: 'failed', error: { description: 'Unable to update user status. Please contact support.' }});
        }
      },
      modal: {
        ondismiss: function() {
          // user closed the checkout
          renderPaymentStep({ stage: 'failed', error: { description: 'Payment modal closed.' }});
        }
      }
    };

    // Optional: you can create an order on your server and supply order_id here for stronger verification.
    // For a pure client-demo, direct checkout works but is not strongly verifiable.

    renderPaymentStep({ stage: 'processing' });

    try {
      const rzp = new Razorpay(options);

      // Payment failed handler
      rzp.on('payment.failed', function (response){
        console.error('payment.failed', response);
        renderPaymentStep({ stage: 'failed', error: response.error || {} });
      });

      rzp.open();
    } catch (err) {
      console.error('Razorpay error', err);
      renderPaymentStep({ stage: 'failed', error: { description: 'Unable to open payment gateway. Try again later.' }});
    }
  }

  // open modal on button
  getPremiumBtn.addEventListener('click', () => openPaymentModal());

  // close clicking outside the card
  paymentModal.addEventListener('click', (e) => { if (e.target === paymentModal) closePaymentModal(); });

  /********************************
   * INITIALIZE APP
   ********************************/
  function init() {
    authView.classList.add('hidden');
    dashboardView.classList.add('hidden');
    initialLoader.classList.remove('hidden');

    setTimeout(() => {
      const saved = getUser();
      if (saved) {
        currentUser = saved;
        renderAppForUser();
      } else {
        initialLoader.classList.add('hidden');
        authView.classList.remove('hidden');
        updateAuthMode();
        authView.scrollIntoView({ behavior: 'smooth' });
      }
    }, 500);
  }

  window.addEventListener('storage', (e) => {
    if (e.key === STORAGE_KEYS.USER) {
      const saved = getUser();
      if (!saved) {
        dashboardView.classList.add('hidden');
        authView.classList.remove('hidden');
      } else {
        currentUser = saved;
        renderAppForUser();
      }
    }
  });

  // Start
  init();

  // expose helper for testing
  window.BUILDORA = { openPaymentModal };

})();
</script>

</body>
</html>
